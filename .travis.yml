sudo: required

language: python
python: 2.7
dist: trusty

services:
  - docker

env:
  global:
    - DOCKER_USERNAME=louisleblin
    # DOCKER_PASSWORD=<securely define on web interface>
  matrix:
    - DOCKER_IMAGE=pynn8      DOCKER_TAG_PROD=latest     DOCKER_TAG_DEV=dev
    - DOCKER_IMAGE=toolchain  DOCKER_TAG_PROD=v2016.001  DOCKER_TAG_DEV=v2016.001-dev
    - DOCKER_IMAGE=toolchain  DOCKER_TAG_PROD=v4.0.0     DOCKER_TAG_DEV=v4.0.0-dev

install:
  - echo "Nothing to do"

script:
  - | # Build docker PROD image
    docker build \
    --tag "${DOCKER_USERNAME}/${DOCKER_IMAGE}:${DOCKER_TAG_PROD}" \
    --file "images/${DOCKER_IMAGE}/Dockerfile" \
    --build-arg DOCKER_TAG="${DOCKER_TAG_PROD}" \
    images
  - | # Build docker DEV image
    docker build \
    --tag "${DOCKER_USERNAME}/${DOCKER_IMAGE}:${DOCKER_TAG_DEV}" \
    --file images/common/Dockerfile-dev \
    --build-arg BASE_IMAGE="${DOCKER_IMAGE}:${DOCKER_TAG_PROD}" \
    images

# Publish on DockerHub
deploy:
  provider: script
  script: ./scripts/docker_push
  on:
    branch: master

notifications:
  email: false
